<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
			http://www.springframework.org/schema/beans 
	   		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	   		http://www.springframework.org/schema/context
	   		http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<!-- Modificacions EMISERV                                                -->
	<!--     1.- Substituir el scspPropertyPlaceholderConfigurer per un altre -->
	<!--         que agafa la configuració dels properties de EMISERV.        -->
	<!--     2.- Configurar un nou datasource que agafi la seva configuració  -->
	<!--         de JNDI.                                                     -->
	<!--     3.- Canviar les propietats de ${config: a                        -->
	<!--         ${config:es.caib.pinbal.scsp                                 -->
	<!--     4.- Modificar el sessionFactory per agafar el mateix dataSource  -->
	<!--         que te EMISERV.                                              -->
	<!--     5.- Desactivar el proxyManager comentant properties.             -->

	<bean id="propertyPlaceholderConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location" value="${es.caib.emiserv.properties.path}" />
		<property name="placeholderPrefix" value="${config:" />
	</bean>
	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="resourceRef" value="true" />
		<property name="jndiName" value="${config:es.caib.emiserv.datasource.jndi}" />
	</bean>

	<!-- Este fichero contiene la configuracion de Spring de las librerias    -->
	<!-- SCSP V3. Evite realizar modificaciones en este fichero ya que la     -->
	<!-- configuracion se debera realizar a traves de base de datos.          -->
	<context:annotation-config />
	<!--context:component-scan base-package="es.scsp" /-->
	<context:component-scan base-package="es.scsp">
		<context:exclude-filter type="regex" expression="es\.scsp\.client\.BasicServiceClient"/>
		<context:exclude-filter type="regex" expression="es\.scsp\.client\.ClienteUnico"/>
		<context:exclude-filter type="regex" expression="es\.scsp\.common\.task\.PollingTask"/>
		<context:exclude-filter type="regex" expression="es\.scsp\.common\.task\.ScheduledTaskExecutor"/>
	</context:component-scan>

	<bean id="configuracionBackOfficeDao" class="es.scsp.common.dao.EmisorBackOfficeDao"	/>
	<bean id="gestorSeguridad" class="es.scsp.common.core.LoginManager"	/>

	<!-- ==================================================================== -->
	<!-- Clases que implementan los servicios sincronos y asincronos          -->
	<!-- ==================================================================== -->
	<bean id="serviceAsync" class="es.scsp.services.impl.ServiceAsyncImpl">
		<constructor-arg index="0" ref="configuracionBackOfficeDao" />
		<constructor-arg index="1" ref="marshaller" />
		<constructor-arg index="2" ref="unmarshaller" />
		<constructor-arg index="3" ref="bindingConfiguration" />
		<constructor-arg index="4" ref="idTransmisionGenerator" />
		<constructor-arg index="5" ref="serviceManager" />
	</bean>
	<bean id="serviceSync" class="es.scsp.services.impl.ServiceSyncImpl">
		<constructor-arg index="0" ref="configuracionBackOfficeDao" />
		<constructor-arg index="1" ref="marshaller" />
		<constructor-arg index="2" ref="unmarshaller" />
		<constructor-arg index="3" ref="bindingConfiguration" />
		<constructor-arg index="4" ref="idTransmisionGenerator" />
		<constructor-arg index="5" ref="serviceManager" />
	</bean>
	<bean id="applicationContex" class="org.apache.axis2.extensions.spring.receivers.ApplicationContextHolder" />

	<!-- ==================================================================== -->
	<!-- Gestores de configuracion                                            -->
	<!-- ==================================================================== -->
	<bean id="scspPropertyPlaceholderConfigurer" class="es.scsp.common.utils.ScspPropertyPlaceholderConfigurer" />
	<!--bean id="scspPropertyPlaceholderConfigurer"  class="es.scsp.common.utils.ScspPropertyPlaceholderConfigurer" depends-on=" sessionFactory" > 
		<constructor-arg index="0" ref="sessionFactory" />
		<property name="placeholderPrefix" value="${config:" /> 
		<property name="ignoreResourceNotFound" value="true"/>
		<property name="ignoreUnresolvablePlaceholders" value="true"/> 
	</bean-->

	<!-- ==================================================================== -->
	<!-- Configuracion de binding.                                            -->
	<!-- ==================================================================== -->
	<alias name="jibxMarshaller" alias="marshaller" />
	<alias name="jibxMarshaller" alias="unmarshaller" />

	<!-- ==================================================================== -->
	<!-- Configuracion de acceso base de datos.                               -->
	<!-- ==================================================================== -->
	<bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="packagesToScan" value="es.scsp.common.domain.core.**,es.scsp.common.domain.emi.**" />
		<property name="hibernateProperties">
			<value>
				hibernate.dialect=${config:es.caib.emiserv.hibernate.dialect}
				hibernate.hbm2ddl.auto=${config:es.caib.emiserv.hibernate.hbm2ddl.auto}
				hibernate.show_sql=${config:es.caib.emiserv.hibernate.show_sql}
				hibernate.transaction.factory_class=org.hibernate.transaction.JDBCTransactionFactory
				hibernate.current_session_context_class=thread
				hibernate.dbcp.enabled=false
				hibernate.dbcp.initialSize=10
				hibernate.dbcp.maxActive=50
				hibernate.dbcp.minIdle=15
				hibernate.dbcp.maxIdle=50
				hibernate.dbcp.maxWait=5000
				hibernate.c3p0.idle_test_period=300
				hibernate.c3p0.timeout=500
				hibernate.c3p0.max_size=25
				hibernate.c3p0.min_size=3
				hibernate.c3p0.validate.in=true
				hibernate.c3p0.validate.out=true
      		</value>
		</property>
	</bean>

	<!-- ==================================================================== -->
	<!-- Recursos adicionales.                                                -->
	<!-- ==================================================================== -->
	<bean id="dateFormater" class="java.text.SimpleDateFormat">
		<constructor-arg value="yyyy-MM-dd'T'HH:mm:ss.SSSZ" />
	</bean>  

	<!-- ==================================================================== -->
	<!-- Cliente Spring de Afirma                                             -->
	<!-- ==================================================================== -->
	<bean id="messageFactory" class="org.springframework.ws.soap.axiom.AxiomSoapMessageFactory" />
	<bean id="afirmaWssHandler" class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor">
		<property name="securementActions" value="Signature" />
		<property name="securementSignatureKeyIdentifier" value="DirectReference" />
		<property name="securementMustUnderstand" value="false" />
		<property name="securementSignatureCrypto">
			<bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean">
				<property name="keyStoreLocation" value="${config:es.caib.emiserv.scsp.keystoreFile}" />
				<property name="keyStorePassword" value="${config:es.caib.emiserv.scsp.keystorePass}" />
			</bean>
		</property>
	</bean>
 	<bean id="proxyManager" class="es.scsp.common.utils.ProxyManager">
			<!-- property name="host"  value="${config:es.caib.emiserv.proxy.host}" />
			<property name="port"  value="${config:es.caib.emiserv.proxy.port}" /> 
			<property name="user"  value="${config:es.caib.emiserv.proxy.user}" /> 
			<property name="password"  value="${config:es.caib.emiserv.proxy.password}" />
			<property name="domain"  value="${config:es.caib.emiserv.proxy.domain}" />
			<property name="nonHostsProxy"  value="${config:es.caib.emiserv.proxy.non.proxy.hosts}" /-->
	</bean>

</beans>